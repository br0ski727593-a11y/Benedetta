<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Board Tutor</title>
    <style>
        :root { 
            --primary: #2563eb; 
            --background: #f8fafc; 
            --surface: #ffffff;
            --text: #0f172a; 
            --ai-color: #7c3aed; 
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--background); 
            color: var(--text); 
            line-height: 1.6; 
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
            min-height: 100vh; 
        }

        .app-container { 
            background: var(--surface); 
            width: 100%; 
            max-width: 800px; 
            padding: 2.5rem; 
            border-radius: 16px; 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); 
        }

        .hidden { display: none; }
        
        button { cursor: pointer; border: none; font-weight: 700; transition: transform 0.1s, opacity 0.2s; }
        button:active { transform: scale(0.98); }

        /* Main Start Button */
        .primary-btn { 
            background: var(--primary); 
            color: white; 
            width: 100%; 
            font-size: 1.2rem; 
            padding: 16px; 
            border-radius: 12px; 
            margin-top: 20px; 
        }
        
        /* AI Button */
        .ai-btn { 
            background: linear-gradient(135deg, #7c3aed, #6d28d9); 
            color: white; 
            padding: 12px 24px; 
            border-radius: 8px; 
            margin: 25px auto; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px;
            width: 100%; 
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(124, 58, 237, 0.2);
        }
        
        /* Quiz Options */
        .option-btn { 
            display: block; 
            width: 100%; 
            padding: 16px; 
            margin: 12px 0; 
            border: 2px solid #e2e8f0; 
            background: white; 
            text-align: left; 
            border-radius: 12px; 
            font-size: 1rem; 
            color: var(--text);
        }
        .option-btn:hover { border-color: var(--primary); background: #eff6ff; }
        
        .option-btn.correct { background: #dcfce7; border-color: #16a34a; color: #14532d; }
        .option-btn.wrong { background: #fee2e2; border-color: #dc2626; color: #7f1d1d; }
        .option-btn.selected { border-color: var(--primary); background: #eff6ff; font-weight: 600; }
        
        /* AI Box */
        #ai-response-box { 
            background: #f5f3ff; 
            padding: 20px; 
            border-radius: 12px; 
            margin-top: 15px; 
            display: none; 
            border: 1px solid #d8b4fe; 
            color: #4c1d95; 
            font-size: 0.95rem;
        }
        
        /* Navigation */
        .nav-container { display: flex; justify-content: space-between; margin-top: 30px; }
        .nav-btn { 
            background: white; 
            border: 2px solid #e2e8f0; 
            padding: 10px 24px; 
            border-radius: 8px; 
            color: #64748b; 
        }
        .nav-btn:hover { border-color: #94a3b8; color: var(--text); }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .header { display: flex; justify-content: space-between; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 20px; }
        
        /* Loading Animation */
        .dots::after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body>

<div class="app-container">
    <div id="setup-view" style="text-align:center; padding: 2rem 0;">
        <h1 style="color: var(--primary); margin-bottom: 10px;">Medical Board Tutor</h1>
        <p style="color: #64748b;">AI Status: <strong style="color: #16a34a;">CONNECTED</strong></p>
        <p style="font-size: 0.9rem; color: #94a3b8;">Ready to start your session?</p>
        <button class="primary-btn" onclick="startNewQuiz()">Start Quiz</button>
    </div>

    <div id="quiz-view" class="hidden">
        <div class="header">
            <span id="progress-text" style="font-weight:700; color:#64748b; font-size: 0.9rem; text-transform: uppercase;">Question 1</span>
            <span id="score-text" style="font-weight:700; color:var(--primary); font-size: 0.9rem; text-transform: uppercase;">Score: 0%</span>
        </div>
        
        <p id="q-text" style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;"></p>
        <div id="options-container"></div>
        
        <button class="ai-btn" onclick="askAI()">
            <span>âœ¨ Explain This Question</span>
        </button>
        <div id="ai-response-box"></div>

        <div class="nav-container">
            <button class="nav-btn" id="prev-btn" onclick="nav(-1)">Previous</button>
            <button class="nav-btn" id="next-btn" onclick="nav(1)">Next</button>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
             <button onclick="exitToMenu()" style="background: none; text-decoration: underline; color: #94a3b8; font-weight: normal; font-size: 0.9rem;">Exit to Menu</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // CONFIGURATION
    // ==========================================
    const API_KEY = "AIzaSyAwvv2MjKEYA8VG8UEvVrv3zi7AiNARaxU"; 
    // ==========================================

    // --- DATABASE (First 30 Questions) ---
    const db = [
        { q: "A 10-month-old boy is poorly gaining weight. His mother complains about his constant persistent cough. Sputum is thick and viscous. The boy had pneumonia three times. His sweat chloride levels are over 80 mEq/L. What is the most likely diagnosis?", o: ["Mucoviscidosis (cystic fibrosis)", "Bronchial asthma", "Congenital lung abnormality", "A foreign body in the bronchi", "Chronic bronchitis"], a: 0 },
        { q: "A 42-year-old man, suffering from duodenal ulcer for 20 years, reports heaviness in stomach, eructation with smell of decay, vomiting food eaten the day before, and 'sloshing sound' in epigastrium. What complication is most likely?", o: ["Ulcer penetration", "Chronic pancreatitis", "Ulcerative stenosis of the pylorus", "Covered perforation of an ulcer", "Stomach cancer"], a: 2 },
        { q: "A 22-year-old pregnant woman (severe condition) has edemas, headache, BP 160/130. She developed seizures, stopped breathing, then foam appeared on lips. What is the diagnosis?", o: ["Hypertensive crisis", "Diabetic coma", "Chorea", "Eclampsia", "Epilepsy"], a: 3 },
        { q: "A 45-year-old patient has skin rash on trunk/limbs after stress. Plaques with silvery-yellow scales. 'Stearin spot' symptom is positive. What is the diagnosis?", o: ["Dermatophytosis", "Eczema", "Lichen ruber planus", "Allergic dermatitis", "Psoriasis"], a: 4 },
        { q: "A 23-year-old man swallowed brake fluid. Anuria for 5 days, creatinine 0.569 mmol/L. What treatment tactics should be chosen?", o: ["Diuretics", "Antidotal therapy", "Hemodialysis", "Plasmapheresis", "Detoxication therapy"], a: 2 },
        { q: "A 19-year-old woman with no menstruations, lethargy, weight loss. Pathological childbirth 1 year ago with blood loss and no lactation. Hypoestrogenemia. What is the diagnosis?", o: ["Stein-Leventhal syndrome", "Hypothyroidism", "Astheno-vegetative syndrome", "Genital tuberculosis", "Sheehan syndrome"], a: 4 },
        { q: "A 64-year-old patient with sigmoid colon tumor and chronic thrombophlebitis is scheduled for surgery. What is the optimal medicine for DVT prevention?", o: ["Phenylinum", "Low-molecular-weight heparin", "Regular heparin", "Acetylsalicylic acid", "Rheopolyglucin"], a: 1 },
        { q: "A 40-year-old patient with cough, mucopurulent sputum, fever 37.6Â°C. Smoker since 17. Auscultation: coarse respirations, diffuse dry crackles. Bronchoscopy: purulent catarrhal endobronchitis. Diagnosis?", o: ["Lung cancer", "Bronchial asthma", "Community-acquired pneumonia", "Pulmonary tuberculosis", "Chronic bronchitis"], a: 4 },
        { q: "A 5-day-old girl, 3100g. Icteric skin on day 3. Condition satisfactory. Liver +1 cm, spleen '-'. Mother A(II)Rh+, Child 0(I)Rh+. Bilirubin 140 mcmol/L (indirect), direct 0. Diagnosis?", o: ["Hemolytic anemia", "Congenital hepatitis", "Biliary atresia", "Hemolytic disease of newborn", "Physiological jaundice"], a: 4 },
        { q: "A 57-year-old miner, smoker (40 yrs). Chest pain, dyspnea, blood-streaked sputum. X-ray: triangular shadow in middle lobe of right lung, apex points to lung root. Diagnosis?", o: ["Pneumoconiosis", "Tuberculosis of right lung", "Cancer of right lung", "Chronic bronchitis", "Right-sided pleuropneumonia"], a: 2 },
        { q: "Factory produces chromium and nickel compounds. Medical committee includes: therapist, dermatologist, traumatologist, ophthalmologist, neurologist, etc. What is the MINIMUM composition required?", o: ["Therapist, hematologist, ophthalmologist", "Otolaryngologist, therapist, dermatologist", "Therapist, immunologist, surgeon", "Therapist, dermatologist, traumatologist", "Therapist, ophthalmologist, neurologist"], a: 1 },
        { q: "18-year-old patient with skin rash for 5 years. Started after car accident. Papular rash with silvery scales, 'thimble' sign on nails, affected joints. Diagnosis?", o: ["Lupus erythematosus", "Rheumatism", "Panaritium", "Onychomycosis", "Psoriasis"], a: 4 },
        { q: "Children in Africa diagnosed with kwashiorkor (growth inhibition, edema, mental changes). What food products should be added to diet?", o: ["Milk, meat, vegetables", "Fish, vegetables, cereals", "Poultry, fruit, berries", "Vegetables, fruit", "Cereals, fruit, berries"], a: 1 },
        { q: "25-year-old man, hematuria after cold exposure. BP 160/110. Urine: proteinuria 3.5 g/L, erythrocytes cover field, hyaline casts. Most informative diagnostic method?", o: ["Excretory urography", "Kidney ultrasound", "Cystoscopy", "Tomography", "Kidney biopsy"], a: 4 },
        { q: "37-year-old woman received occupational trauma resulting in severe vision impairment. Needs training for new occupation. What type of rehabilitation?", o: ["Occupational rehabilitation", "Social rehabilitation", "Psychological rehabilitation", "Medical rehabilitation", "Target rehabilitation"], a: 0 },
        { q: "44-year-old man, drinking vodka daily for 6 days. On 3rd night: anxiety, fear, visual hallucinations (horror movie on wall), threats. Diagnosis?", o: ["Somatogenic psychosis", "Delirium tremens", "Obsessive-phobic neurosis", "Occupational delirium", "Alcoholic hallucinosis"], a: 1 },
        { q: "50-year-old man at paint factory. Weakness, dizziness, pain in back. Skin earth-gray, icteric sclera. Heinz-Ehrlich bodies in blood, methemoglobin 62%. Diagnosis?", o: ["Chronic cyanide poisoning", "Acute aniline poisoning", "Acute toluene poisoning", "Acquired hemolytic anemia", "Acute viral hepatitis"], a: 1 },
        { q: "18-year-old ate smoked fish and mushrooms. 6 hours later: vision impairment, 'fog', swallowing problems. Dilated pupils, dry mouth. Diagnosis?", o: ["Botulism", "Mushroom poisoning", "Salmonellosis", "Fish poisoning", "Staphylococcal intoxication"], a: 0 },
        { q: "8-year-old boy had Hepatitis B a year ago. Now complains of fatigue, disturbed sleep, nausea. Liver/spleen +1cm. ALT 220 units. Interpretation?", o: ["Recurrence of viral hepatitis B", "Biliary dyskinesia", "Development of hepatic cirrhosis", "Development of chronic hepatitis", "Residual effects of hepatitis B"], a: 3 },
        { q: "45-year-old man, duodenal ulcer for 5 years. Weakness, dizziness. Pale skin. Systolic murmur. Hb 88 g/l, Serum Iron 9.5 mcmol/l. Treatment?", o: ["Corticosteroids", "Ascorbic acid", "Cyanocobalamin", "Iron preparations, balanced diet", "Red cells transfusion"], a: 3 },
        { q: "Woman with polycystic kidney disease. Urine output 2-2.5 L. GFR 34 mL/min, creatinine 84 mcmol/L. What stage of chronic kidney failure?", o: ["Polyuric", "Intermittent", "Latent", "Terminal", "Compensated"], a: 4 },
        { q: "27-year-old woman, frequent stools with mucus, abdominal pain abating after defecation. Colonoscopy normal. Diagnosis?", o: ["Crohn disease", "Irritable bowel syndrome", "Whipple disease", "Chronic non-ulcerative colitis", "Chronic enteritis"], a: 1 },
        { q: "46-year-old woman, sharp pain in right subcostal region radiating to shoulder at 3 a.m. Vomiting, fever 39Â°C. Tense muscles right subcostal. Diagnosis?", o: ["Cholelithiasis", "Benign stricture bile duct", "Unstable angina", "Peptic ulcer disease", "Acute cholecystitis"], a: 4 },
        { q: "56-year-old woman, disinfector for 19 years. Nausea, bitter taste, heavy right subcostal. Liver enlarged. Bilirubin 40 mcmol/L. Diagnosis?", o: ["Chronic cholecystitis", "Chronic pancreatitis", "Occupational toxic hepatitis", "Biliary dyskinesia", "Acute cholecystitis"], a: 2 },
        { q: "8-year-old, growth retardation. Height 107cm. 'Doll's face', thin hair, dry skin. High subcutaneous fat on torso. Diagnosis?", o: ["Pituitary dwarfism", "Chondrodystrophy", "Craniopharyngioma", "Fanconi syndrome", "Down syndrome"], a: 0 },
        { q: "5-year-old child, cough attacks with reprises. Face turns red, veins bulge. Vomiting after cough. Lymphocytes 72%. Diagnosis?", o: ["Foreign body", "Pertussis", "Adenovirus", "Pneumonia", "Obstructive bronchitis"], a: 1 },
        { q: "Man with urolithiasis and hyperoxaluria. What products to reduce?", o: ["Dairy", "Meat, fish", "Fatty foods", "Canned soup", "Sorrel, spinach, tomatoes"], a: 4 },
        { q: "Newborn 3980g. Obstetric assistance used. Right hand adducted, rotated, no movement in shoulder/elbow. 'Doll's arm'. Diagnosis?", o: ["Dejerine-Klumpke paresis", "Total brachial plexus paresis", "Duchenne-Erb paresis", "Dislocation right shoulder", "Humerus fracture"], a: 2 },
        { q: "10-year-old boy, seasonal stuffy nose (spring/autumn). Pale, swollen face. Father has asthma. Rhinoscopy: swollen pale mucosa. Diagnosis?", o: ["Acute rhinitis", "Acute maxillary sinusitis", "Acute adenoiditis", "Allergic rhinitis", "Recurrent respiratory disease"], a: 3 },
        { q: "40-year-old woman with epilepsy. After psychotrauma, seizures occur every 2-3 minutes without regaining consciousness. Pupils unresponsive. Diagnosis?", o: ["Increase in grand mal seizures", "Hysterical attack", "Status epilepticus", "Absence seizure", "Epileptic psychosis"], a: 2 }
    ];

    let activeQ = [];
    let answers = {};
    let idx = 0;

    function startNewQuiz() {
        activeQ = db.sort(() => 0.5 - Math.random()); 
        userAnswers = {};
        idx = 0;
        document.getElementById('setup-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.remove('hidden');
        render();
    }
    
    function exitToMenu() {
        if(confirm("Exit to main menu? Progress will be lost.")) {
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('setup-view').classList.remove('hidden');
        }
    }

    function render() {
        const q = activeQ[idx];
        document.getElementById('progress-text').innerText = `Question ${idx + 1}/${activeQ.length}`;
        document.getElementById('q-text').innerText = q.q;
        
        let correctCount = 0;
        let answeredCount = 0;
        Object.keys(answers).forEach(k => {
            answeredCount++;
            if(answers[k] === activeQ[k].a) correctCount++;
        });
        const score = answeredCount === 0 ? 0 : Math.round((correctCount/answeredCount)*100);
        document.getElementById('score-text').innerText = `Score: ${score}%`;

        const div = document.getElementById('options-container');
        div.innerHTML = '';
        
        q.o.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            if(answers[idx] !== undefined) {
                if(i === q.a) btn.classList.add('correct');
                if(i === answers[idx] && i !== q.a) btn.classList.add('wrong');
                if(i === answers[idx]) btn.classList.add('selected');
            }
            btn.onclick = () => { answers[idx] = i; render(); };
            div.appendChild(btn);
        });
        
        document.getElementById('ai-response-box').style.display = 'none';
        
        document.getElementById('prev-btn').disabled = (idx === 0);
        document.getElementById('next-btn').disabled = (idx === activeQ.length - 1);
    }

    function nav(d) {
        if(idx + d >= 0 && idx + d < activeQ.length) { idx += d; render(); }
    }

    async function askAI() {
        const q = activeQ[idx];
        const box = document.getElementById('ai-response-box');
        box.style.display = 'block';
        box.innerHTML = "<span class='dots'><strong>ðŸ¤– AI is analyzing</strong></span>";

        const prompt = `
        You are a medical board exam tutor.
        Question: "${q.q}"
        Correct Answer: "${q.o[q.a]}"
        Options: ${JSON.stringify(q.o)}
        
        Task:
        1. Explain concisely why the correct answer is the best choice (focus on key clinical signs).
        2. Briefly explain why the other options are incorrect/less likely.
        3. Keep it educational and encouraging.
        `;
        
        try {
            // FIXED MODEL: gemini-1.5-flash
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            
            const data = await response.json();
            
            if(data.error) {
                box.innerHTML = `<span style="color:red">AI Error: ${data.error.message}</span>`;
            } else {
                const text = data.candidates[0].content.parts[0].text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');
                box.innerHTML = text;
            }
                
        } catch (e) {
            box.innerHTML = `<span style="color:red">Connection Error: ${e.message}</span>`;
        }
    }
</script>
</body>
</html>
