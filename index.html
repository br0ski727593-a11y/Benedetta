<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Medical Board Tutor</title>
    <style>
        :root { --primary: #2563eb; --background: #f8fafc; --surface: #ffffff; --text: #0f172a; --ai: #7c3aed; --error: #ef4444; }
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--background); color: var(--text); padding: 15px; display: flex; justify-content: center; min-height: 100vh; margin: 0; }
        .app-container { background: var(--surface); width: 100%; max-width: 600px; padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: flex; flex-direction: column; }
        .hidden { display: none !important; }
        
        h1 { margin: 0 0 10px 0; font-size: 1.5rem; color: var(--primary); text-align: center; }
        p { color: #64748b; margin: 5px 0; text-align: center; }
        
        button { cursor: pointer; border: none; font-weight: 600; transition: all 0.2s; border-radius: 10px; font-size: 1rem; padding: 12px; }
        button:active { transform: scale(0.98); }
        .primary-btn { background: var(--primary); color: white; width: 100%; margin-top: 20px; font-size: 1.1rem; padding: 15px; }
        .ai-btn { background: #f3e8ff; color: var(--ai); border: 1px solid var(--ai); width: 100%; margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .perplex-btn { background: #e0f2fe; color: #0284c7; border: 1px solid #0284c7; flex: 1; margin: 0 5px; }
        .nav-btn { background: white; border: 1px solid #cbd5e1; color: #64748b; width: 80px; }

        #q-text { font-size: 1.15rem; font-weight: 700; margin: 20px 0; line-height: 1.5; }
        .option-btn { display: block; width: 100%; text-align: left; background: white; border: 2px solid #e2e8f0; margin-bottom: 10px; padding: 15px; color: var(--text); }
        .option-btn.correct { background: #dcfce7; border-color: #16a34a; color: #14532d; }
        .option-btn.wrong { background: #fee2e2; border-color: #dc2626; color: #7f1d1d; }

        #ai-box { background: #f3e8ff; padding: 15px; border-radius: 10px; margin-top: 10px; display: none; font-size: 0.95rem; line-height: 1.6; border-left: 4px solid var(--ai); }
        .spinner { display: inline-block; width: 12px; height: 12px; border: 2px solid currentColor; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .header { display: flex; justify-content: space-between; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; margin-bottom: 15px; font-size: 0.9rem; font-weight: 700; }
        .nav-row { display: flex; justify-content: space-between; margin-top: 20px; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="start-screen">
        <h1>Medical Board Tutor</h1>
        <p>Database: <strong>250 Questions</strong></p>
        <p>AI Engine: <strong>Gemini 2.0 Flash</strong></p>
        <button class="primary-btn" onclick="startQuiz()">Start Session</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="header">
            <span id="progress">Q 1</span>
            <span id="score" style="color: var(--primary);">Score: 0%</span>
        </div>

        <div id="q-text">Loading...</div>
        <div id="options"></div>

        <button class="ai-btn" onclick="askAI()"><span>‚ú® Explain (AI 2.0)</span></button>
        <div id="ai-box"></div>

        <div class="nav-row">
            <button class="nav-btn" id="btn-prev" onclick="move(-1)">Prev</button>
            <button class="perplex-btn" onclick="smartSearch()">üöÄ Ask Perplexity</button>
            <button class="nav-btn" id="btn-next" onclick="move(1)">Next</button>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <a href="#" onclick="location.reload()" style="color: #94a3b8; font-size: 0.85rem;">Exit to Menu</a>
        </div>
    </div>
</div>

<script>
    // --- I CHECKED THIS: YOUR ACTUAL KEY IS BELOW ---
    const API_KEY = "AIzaSyDOXuMkT0qUpTyAS1OLZbsV-HZdALzNauk"; 
    
    // --- USING THE NEWEST MODEL ---
    const MODEL = "gemini-2.0-flash";

    // --- STATE ---
    let qList = [];
    let currentIdx = 0;
    let answers = {};

    // --- DATABASE ---
    const db = [
        {q:"10-month-old, poor weight gain, thick sputum, sweat chloride >80. Diagnosis?", o:["Cystic Fibrosis","Asthma","Bronchitis","Pneumonia","Foreign Body"], a:0},
        {q:"42yo man, duodenal ulcer, vomiting old food, sloshing sound. Complication?", o:["Penetration","Pancreatitis","Pyloric Stenosis","Perforation","Cancer"], a:2},
        {q:"Pregnant, BP 160/130, seizures, foam. Diagnosis?", o:["HTN Crisis","Coma","Chorea","Eclampsia","Epilepsy"], a:3},
        {q:"Rash after stress, silvery scales, bleeding spots. Diagnosis?", o:["Eczema","Lichen","Allergy","Psoriasis","Ringworm"], a:3},
        {q:"Swallowed brake fluid, Anuria 5 days. Treatment?", o:["Diuretics","Antidote","Hemodialysis","Plasmapheresis","Detox"], a:2},
        {q:"Amenorrhea, weight loss, no lactation after birth hemorrhage. Diagnosis?", o:["PCOS","Hypothyroid","Sheehan Syndrome","TB","Addison"], a:2},
        {q:"Post-op sigmoid tumor, DVT prevention?", o:["Warfarin","LMW Heparin","Aspirin","Regular Heparin","None"], a:1},
        {q:"Smoker, cough, mucopurulent sputum, dry crackles. Diagnosis?", o:["Cancer","Asthma","Pneumonia","TB","Chronic Bronchitis"], a:4},
        {q:"Newborn, jaundice day 5, Mom A+, Baby O+. Diagnosis?", o:["Hemolytic Anemia","Hepatitis","Biliary Atresia","Physiological Jaundice","ABO Incomp"], a:3},
        {q:"Miner, smoker, triangular shadow on X-ray. Diagnosis?", o:["Pneumoconiosis","TB","Cancer","Bronchitis","Pneumonia"], a:2},
        {q:"Chromium factory medical check needs?", o:["Therapist+Derm+ENT","Therapist+Eye+Neuro","Surgeon+Immuno","All","None"], a:1},
        {q:"Rash after trauma, thimble nails. Diagnosis?", o:["Lupus","Rheumatism","Infection","Fungus","Psoriasis"], a:4},
        {q:"Kwashiorkor diet needs?", o:["Milk/Meat","Fish","Fruit","Grains","Water"], a:0},
        {q:"Hematuria after cold, BP 160/110, Proteinuria. Diagnosis?", o:["Urography","Ultrasound","Cystoscopy","Biopsy","CT"], a:3},
        {q:"Blindness from work trauma. Rehab type?", o:["Occupational","Social","Psych","Medical","Target"], a:0},
        {q:"Alcohol withdrawal day 3, visual hallucinations. Diagnosis?", o:["Psychosis","Delirium Tremens","Neurosis","Delirium","Hallucinosis"], a:1},
        {q:"Paint factory, earth-gray skin, Heinz bodies. Diagnosis?", o:["Cyanide","Aniline","Toluene","Anemia","Hepatitis"], a:1},
        {q:"Smoked fish, fog vision, dry mouth. Diagnosis?", o:["Botulism","Mushroom","Salmonella","Fish","Staph"], a:0},
        {q:"Hx Hep B, fatigue, ALT 220. Diagnosis?", o:["Recurrence","Dyskinesia","Cirrhosis","Chronic Hepatitis","Residual"], a:3},
        {q:"Ulcer, pale, systolic murmur, low Iron. Tx?", o:["Steroids","Vit C","B12","Iron","Blood"], a:3},
        {q:"Polycystic kidney, Urine 2.5L, GFR 34. Stage?", o:["Polyuric","Intermittent","Latent","Terminal","Compensated"], a:4},
        {q:"Mucus stools, pain relief after poop. Colonoscopy normal. Diagnosis?", o:["Crohn","IBS","Whipple","Colitis","Enteritis"], a:1},
        {q:"RUQ pain to shoulder, fever, tense. Diagnosis?", o:["Stones","Stricture","Angina","Ulcer","Acute Cholecystitis"], a:4},
        {q:"Disinfector, bitter taste, liver big. Diagnosis?", o:["Cholecystitis","Pancreatitis","Toxic Hepatitis","Dyskinesia","Acute"], a:2},
        {q:"Growth retardation, doll face, thin hair. Diagnosis?", o:["Pituitary Dwarfism","Chondro","Cranio","Fanconi","Down"], a:0},
        {q:"Cough with reprise, red face, veins. Diagnosis?", o:["Foreign Body","Pertussis","Adeno","Pneumonia","Bronchitis"], a:1},
        {q:"Kidney stones (Oxalate). Avoid?", o:["Dairy","Meat","Fat","Soup","Spinach/Tomatoes"], a:4},
        {q:"Newborn arm internal rotation, no movement. Diagnosis?", o:["Klumpke","Total","Erb-Duchenne","Dislocation","Fracture"], a:2},
        {q:"Seasonal stuffy nose, pale mucosa. Diagnosis?", o:["Rhinitis","Sinusitis","Adenoiditis","Allergic Rhinitis","Cold"], a:3},
        {q:"Epilepsy, seizures every 2 min, no wake. Diagnosis?", o:["Grand Mal","Hysteria","Status Epilepticus","Absence","Psychosis"], a:2},
        {q:"Fatigue, cold intolerance, goiter, high TSH. Diagnosis?", o:["Graves","Hashimoto","Subacute","Adenoma","Iodine"], a:1},
        {q:"Crushing chest pain, ST elev II, III, aVF. Artery?", o:["LAD","Circ","RCA","Left Main","PDA"], a:2},
        {q:"Child fever 5 days, strawberry tongue, peeling. Complication?", o:["Renal","Coronary Aneurysm","Meningitis","Liver","PE"], a:1},
        {q:"Aggressive, vertical nystagmus, strong. Drug?", o:["Cocaine","Heroin","PCP","Alcohol","Benzo"], a:2},
        {q:"Painless vision loss, arm weak. MRI plaques. Diagnosis?", o:["MS","Guillain","Myasthenia","Stroke","Tumor"], a:0},
        {q:"Painless hematuria, smoker. Gold standard?", o:["CT","US","Cystoscopy","MRI","KUB"], a:2},
        {q:"A-fib, severe abd pain, normal exam. Diagnosis?", o:["Appy","Mesenteric Ischemia","Divert","Obstruct","Chole"], a:1},
        {q:"Projectile non-bilious vomiting, olive mass. Diagnosis?", o:["Intussusception","Pyloric Stenosis","Hirsch","Volvulus","GERD"], a:1},
        {q:"Painless vaginal bleeding, placenta over os. Diagnosis?", o:["Abruption","Vasa","Placenta Previa","Rupture","Cervicitis"], a:2},
        {q:"Itching at night, high Alk Phos, +AMA. Diagnosis?", o:["PSC","PBC","Autoimmune","Cirrhosis","Hemo"], a:1},
        {q:"Asbestos, pleural thickening, bloody effusion. Diagnosis?", o:["Small Cell","Adeno","Mesothelioma","Squamous","TB"], a:2},
        {q:"Haloperidol, fever 40C, rigidity. Diagnosis?", o:["Serotonin","NMS","Malignant Hyper","Anti-Chol","Dystonia"], a:1},
        {q:"Athlete collapse, family death. Diagnosis?", o:["Dilated","Hypertrophic CM","MVP","AS","Myocarditis"], a:1},
        {q:"SLE, steroids, hip pain. Crescent sign. Diagnosis?", o:["OA","Avascular Necrosis","RA","Septic","Osteo"], a:1},
        {q:"Continuous machinery murmur. Diagnosis?", o:["VSD","ASD","PDA","Tetralogy","Coarct"], a:2},
        {q:"Alcoholic, confusion, ataxia, eye issue. Diagnosis?", o:["Korsakoff","Wernicke","DT","Hepatic","Subdural"], a:1},
        {q:"Moon face, buffalo hump. Screen?", o:["Cortisol","ACTH","Dex Suppression","MRI","TSH"], a:2},
        {q:"Back pain night, M-spike. Diagnosis?", o:["Myeloma","Prostate","Lymphoma","Osteo","Paget"], a:0},
        {q:"Limp after URI, afebrile. Diagnosis?", o:["Septic","Transient Synovitis","Perthes","SCFE","Osteo"], a:1},
        {q:"Rubbery mobile breast mass. Diagnosis?", o:["Cystic","Fibroadenoma","Papilloma","Ca","Fat"], a:1},
        {q:"HIV CD4 40, pizza pie retina. Diagnosis?", o:["Toxo","CMV","PCP","Candida","HSV"], a:1},
        {q:"Snuffbox tenderness, X-ray neg. Next?", o:["MRI","Thumb Spica","Wrap","Surg","PT"], a:1},
        {q:"Rest tremor, shuffle. Low what?", o:["Serotonin","Ach","Dopamine","GABA","NorEpi"], a:2},
        {q:"Palm/sole rash, painless ulcer hx. Diagnosis?", o:["Herpes","Syphilis","Chancroid","Gonorrhea","HPV"], a:1},
        {q:"Unilateral throbbing headache, tearing. Diagnosis?", o:["Migraine","Tension","Cluster","Sinus","Temporal"], a:2},
        {q:"DM1, fruity breath, vomiting. Priority?", o:["Insulin","Fluids","Bicarb","K","Abx"], a:1},
        {q:"Fall, leg short/ext rotated. Diagnosis?", o:["Post Disloc","Femoral Neck Fx","Intertroch","Pelvic","Ant Disloc"], a:1},
        {q:"Systolic murmur R upper sternal, syncope. Diagnosis?", o:["MR","AS","AR","MS","TR"], a:1},
        {q:"Amenorrhea, web neck. Karyotype?", o:["46XX","47XXY","45XO","47XXX","46XY"], a:2},
        {q:"Target lesions after Herpes. Diagnosis?", o:["SJS","Erythema Multiforme","Psoriasis","Lichen","Contact"], a:1},
        {q:"Big toe pain, needle crystals. Diagnosis?", o:["Pseudo","Septic","Gout","RA","OA"], a:2},
        {q:"No meconium, transition zone. Diagnosis?", o:["Ileus","Hirschsprung","Intuss","Anus","NEC"], a:1},
        {q:"Back pain morning, HLA-B27. Diagnosis?", o:["Strain","Ankylosing Spond","Disc","Stenosis","Reactive"], a:1},
        {q:"Warfarin skin necrosis. Def?", o:["Factor V","Protein C","Antithrombin","Prothrombin","Lupus"], a:1},
        {q:"Numb digits 1-3, Phalen+. Nerve?", o:["Ulnar","Radial","Median","Musc","Axillary"], a:2},
        {q:"Bag of worms scrotum. Concern?", o:["Varicocele","Hydro","Sperm","RCC","Torsion"], a:3},
        {q:"Slapped cheek rash. Diagnosis?", o:["Measles","Rubella","Roseola","Fifth","Scarlet"], a:3},
        {q:"Dysphagia solid/liquid, bird beak. Diagnosis?", o:["GERD","Spasm","Achalasia","Zenker","Sclero"], a:2},
        {q:"Post-splenectomy fever. Org?", o:["Staph","Strep Pneumo","Ecoli","Pseudo","Listeria"], a:1},
        {q:"Painless testicle mass, high AFP. Diagnosis?", o:["Seminoma","Non-Seminoma","Leydig","Hydro","Epi"], a:1},
        {q:"Vertigo, tinnitus, hearing loss episodic. Diagnosis?", o:["BPPV","Meniere","Neuritis","Acoustic","Labyrinth"], a:1},
        {q:"Star of death CT. Cause?", o:["Trauma","Berry Aneurysm","AVM","HTN","Coag"], a:1},
        {q:"Hypotension, muffled heart, JVD. Diagnosis?", o:["Pneumo","Tamponade","MI","PE","Dissect"], a:1},
        {q:"Gout on HCTZ. Why?", o:["Ca","Low Uric Excretion","Purine","Auto","Inf"], a:1},
        {q:"Barking cough, steeple. Diagnosis?", o:["Epiglottis","Croup","Foreign","Asthma","Bronch"], a:1},
        {q:"Cafe au lait, Lisch nodules. Diagnosis?", o:["NF1","NF2","Tuberous","Sturge","VHL"], a:0},
        {q:"HTN, string of beads renal. Diagnosis?", o:["Athero","Fibromuscular Dysplasia","PAN","Stenosis","HTN"], a:1},
        {q:"Hematemesis after retching. Diagnosis?", o:["Varices","Mallory-Weiss","Boerhaave","Ulcer","Gastritis"], a:1},
        {q:"Trachea left, no breath right. Diagnosis?", o:["Left Ten","Right Tension Pneumo","Hemo","Tamp","Flail"], a:1},
        {q:"Painless jaundice, gallbladder palpable. Diagnosis?", o:["Stones","Pancreatic Ca","Hep","Cholang","Liver"], a:1},
        {q:"Winged scapula. Nerve?", o:["Long Thoracic","Axillary","Radial","Musc","Supra"], a:0},
        {q:"Cant abduct >90. Nerve?", o:["Spinal","Axillary","Long","Supra","Radial"], a:0},
        {q:"Wrist drop. Nerve?", o:["Radial","Ulnar","Median","Ax","Musc"], a:0},
        {q:"Claw hand. Nerve?", o:["Ulnar","Median","Radial","Ax","Musc"], a:0},
        {q:"Ape hand. Nerve?", o:["Median","Ulnar","Radial","Ax","Musc"], a:0},
        {q:"Surgical neck fx. Nerve?", o:["Axillary","Radial","Ulnar","Median","Musc"], a:0},
        {q:"Midshaft humerus fx. Nerve?", o:["Radial","Ax","Ulnar","Median","Musc"], a:0},
        {q:"Medial epicondyle fx. Nerve?", o:["Ulnar","Radial","Median","Ax","Musc"], a:0},
        {q:"Carpal tunnel. Nerve?", o:["Median","Ulnar","Radial","Ax","Musc"], a:0},
        {q:"Foot drop. Nerve?", o:["Peroneal","Tibial","Femoral","Obt","Sciatic"], a:0},
        {q:"Cant tiptoe. Nerve?", o:["Tibial","Peroneal","Femoral","Obt","Sciatic"], a:0},
        {q:"No patellar reflex. Nerve?", o:["Femoral","Obt","Sciatic","Tibial","Peroneal"], a:0},
        {q:"No sensation medial thigh. Nerve?", o:["Obturator","Femoral","Sciatic","Tibial","Peroneal"], a:0},
        {q:"Trendelenburg sign. Nerve?", o:["Sup Gluteal","Inf Gluteal","Sciatic","Femoral","Obt"], a:0},
        {q:"Cant rise from chair. Nerve?", o:["Inf Gluteal","Sup Gluteal","Sciatic","Femoral","Obt"], a:0},
        {q:"Initial abduction shoulder. Muscle?", o:["Supraspinatus","Infra","Teres","Subscap","Delt"], a:0},
        {q:"Shoulder disloc common?", o:["Anterior","Posterior","Inf","Sup","Lat"], a:0},
        {q:"Seizure shoulder disloc?", o:["Posterior","Anterior","Inf","Sup","Lat"], a:0},
        {q:"Unhappy triad knee?", o:["ACL/MCL/Med Meniscus","PCL/LCL/Lat","ACL/LCL/Med","PCL/MCL/Lat","ACL/MCL/Lat"], a:0},
        {q:"Drawer sign tests?", o:["Cruciate","Collateral","Meniscus","Patellar","Achilles"], a:0},
        {q:"McMurray tests?", o:["Meniscus","ACL","MCL","PCL","Patella"], a:0},
        {q:"Ankle sprain lig?", o:["ATFL","CFL","PTFL","Deltoid","TibFib"], a:0},
        {q:"Artery with Radial nerve?", o:["Deep Brachial","Brachial","Ax","Ulnar","Radial"], a:0},
        {q:"Artery with Axillary nerve?", o:["Post Circ Humeral","Deep","Brachial","Ax","Subscap"], a:0},
        {q:"Femoral head blood?", o:["Med Circ Femoral","Lat","Obt","Femoral","Deep"], a:0},
        {q:"Rate limit Glycolysis?", o:["PFK-1","Hexo","Pyruvate","Gluco","Aldo"], a:0},
        {q:"Rate limit Gluconeo?", o:["F16BPase","Pyruvate","PEPCK","G6P","PK"], a:0},
        {q:"Rate limit TCA?", o:["Isocitrate DH","Citrate","AlphaKG","Malate","Succ"], a:0},
        {q:"Rate limit Glycogen Syn?", o:["Glycogen Synthase","Phos","Branch","Debranch","UDP"], a:0},
        {q:"Rate limit Glycogenolysis?", o:["Glycogen Phos","Synth","G6P","Gluco","PFK"], a:0},
        {q:"Rate limit HMP?", o:["G6PD","Transket","Transald","Gluta","Perox"], a:0},
        {q:"Rate limit Urea?", o:["CPS-1","OTC","Arg","AS","Lyase"], a:0},
        {q:"Rate limit FA Syn?", o:["ACC","FAS","Carnitine","HMG","Thiol"], a:0},
        {q:"Rate limit Beta Ox?", o:["CAT-1","ACC","FAS","Thiol","DH"], a:0},
        {q:"Rate limit Cholest?", o:["HMG-CoA Reductase","Synth","Thiol","Mev","Squalene"], a:0},
        {q:"Vit C def?", o:["Scurvy","Rickets","Beriberi","Pellagra","Anemia"], a:0},
        {q:"Vit D def kids?", o:["Rickets","Osteo","Scurvy","Beriberi","Pellagra"], a:0},
        {q:"Vit B1 def?", o:["Beriberi/Wernicke","Pellagra","Scurvy","Rickets","Anemia"], a:0},
        {q:"Vit B3 def?", o:["Pellagra","Beriberi","Scurvy","Rickets","Anemia"], a:0},
        {q:"Vit B9 def?", o:["Megalo Anemia","Megalo+Neuro","Micro","Pernicious","Scurvy"], a:0},
        {q:"Vit B12 def?", o:["Megalo+Neuro","Megalo","Micro","Scurvy","Rickets"], a:0},
        {q:"Vit A def?", o:["Night Blind","Rickets","Scurvy","Beriberi","Bleed"], a:0},
        {q:"Vit K def?", o:["Bleed","Clot","Blind","Rickets","Scurvy"], a:0},
        {q:"Vit E def?", o:["Hemolytic/Neuro","Bleed","Blind","Scurvy","Rickets"], a:0},
        {q:"Cherry red spot NO organomegaly?", o:["Tay-Sachs","Niemann","Gaucher","Fabry","Krabbe"], a:0},
        {q:"Cherry red spot + organomegaly?", o:["Niemann","Tay","Gaucher","Fabry","Krabbe"], a:0},
        {q:"Bone pain lysosomal?", o:["Gaucher","Tay","Niemann","Fabry","Krabbe"], a:0},
        {q:"Musty odor?", o:["PKU","Alkap","Homo","Maple","Cystin"], a:0},
        {q:"Black urine air?", o:["Alkaptonuria","PKU","Homo","Maple","Porphyria"], a:0},
        {q:"Sweet urine?", o:["Maple Syrup","PKU","DM","Alkap","Cystin"], a:0},
        {q:"Pacemaker heart?", o:["SA","AV","His","Purk","Vent"], a:0},
        {q:"Slows conduction?", o:["AV","SA","His","Purk","Atria"], a:0},
        {q:"S1 sound?", o:["Mitral/Tri","Aort/Pulm","Mit/Aort","Tri/Pulm","All"], a:0},
        {q:"S2 sound?", o:["Aort/Pulm","Mit/Tri","Mit/Aort","Tri/Pulm","All"], a:0},
        {q:"Starling law?", o:["Preload","After","Cont","HR","Comp"], a:0},
        {q:"Baroreceptors high press?", o:["Carotid/Aortic","Kidney","Atria","Vent","Lung"], a:0},
        {q:"Resp drive healthy?", o:["CO2","O2","pH","Lac","Hb"], a:0},
        {q:"Resp drive COPD?", o:["O2","CO2","pH","Lac","Hb"], a:0},
        {q:"Surfactant source?", o:["Type 2","Type 1","Macro","Goblet","Clara"], a:0},
        {q:"Surfactant job?", o:["Low tension","High tension","Resist","Comp","Trap"], a:0},
        {q:"Renin source?", o:["JG Cells","Macula","Prox","Loop","CD"], a:0},
        {q:"Macula Densa sense?", o:["NaCl","BP","K","pH","O2"], a:0},
        {q:"Aldo site?", o:["CD/Distal","Prox","Loop","Glom","Ureter"], a:0},
        {q:"Aldo effect?", o:["Save Na/Dump K","Dump Na/Save K","Save Ca","Dump Ca","Save Gluc"], a:0},
        {q:"ADH site?", o:["CD","Prox","Loop","Glom","Aff"], a:0},
        {q:"ADH effect?", o:["Water","Na","K","Na","Ca"], a:0},
        {q:"Glucose absorbed?", o:["Proximal","Loop","Distal","CD","Glom"], a:0},
        {q:"Parietal secrete?", o:["HCl/IF","Pepsin","Gastrin","Mucus","Bicarb"], a:0},
        {q:"Chief secrete?", o:["Pepsin","HCl","Gastrin","IF","Somato"], a:0},
        {q:"G cell secrete?", o:["Gastrin","HCl","Pepsin","CCK","Sec"], a:0},
        {q:"Bile made?", o:["Liver","Gall","Pancreas","Stomach","Spleen"], a:0},
        {q:"Bile stored?", o:["Gallbladder","Liver","Pancreas","Duo","Spleen"], a:0},
        {q:"Psammoma bodies?", o:["Papillary Thyroid","Follicular","Medullary","Anaplastic","Lymph"], a:0},
        {q:"Owl eyes (cancer)?", o:["Hodgkin","Non-Hodgkin","Leuk","Myeloma","Burkitt"], a:0},
        {q:"Auer rods?", o:["AML","ALL","CML","CLL","Hairy"], a:0},
        {q:"Philly chrom t(9;22)?", o:["CML","AML","ALL","CLL","Burkitt"], a:0},
        {q:"Starry sky?", o:["Burkitt","Hodg","Follic","Diffuse","MALT"], a:0},
        {q:"Rouleaux?", o:["Myeloma","Leuk","Lymph","Anemia","Poly"], a:0},
        {q:"Tennis rackets (EM)?", o:["Histiocytosis","Sarc","TB","Histo","Asbest"], a:0},
        {q:"Aschoff bodies?", o:["Rheumatic","Endo","MI","Myo","Peri"], a:0},
        {q:"Orphan Annie?", o:["Papillary Thyroid","Follic","Med","Ana","Ad"], a:0},
        {q:"Signet ring?", o:["Gastric","Colon","Panc","Liver","Eso"], a:0},
        {q:"Kimmelstiel-Wilson?", o:["Diabetes","Amyloid","Lupus","Post-Strep","IgA"], a:0},
        {q:"Spike and Dome?", o:["Membranous","Minimal","FSGS","IgA","Good"], a:0},
        {q:"Tram-track?", o:["MPGN","Membranous","Minimal","FSGS","IgA"], a:0},
        {q:"Wire loop?", o:["Lupus","DM","Amyloid","Post-Strep","Good"], a:0},
        {q:"Linear IgG?", o:["Goodpasture","Post-Strep","Lupus","IgA","Wegener"], a:0},
        {q:"Lumpy bumpy?", o:["Post-Strep","Good","Lupus","IgA","Mem"], a:0},
        {q:"Apple green Congo?", o:["Amyloid","Sarc","TB","Weg","Lupus"], a:0},
        {q:"Non-caseating gran?", o:["Sarcoid","TB","Histo","Blasto","Cocci"], a:0},
        {q:"Caseating gran?", o:["TB","Sarc","Crohn","Weg","Foreign"], a:0},
        {q:"Keratin pearls?", o:["Squamous","Basal","Mel","Adeno","Sarc"], a:0},
        {q:"Lewy bodies?", o:["Parkinson","Alz","Hunt","Pick","ALS"], a:0},
        {q:"Neurofib tangles?", o:["Alzheimer","Park","Hunt","Lewy","ALS"], a:0},
        {q:"Negri bodies?", o:["Rabies","Herpes","CMV","Measles","Polio"], a:0},
        {q:"Cowdry A?", o:["HSV/VZV","Rabies","CMV","Measles","HPV"], a:0},
        {q:"Owl eye (viral)?", o:["CMV","HSV","Rabies","Measles","HPV"], a:0},
        {q:"Koilocytes?", o:["HPV","HSV","CMV","EBV","HIV"], a:0},
        {q:"Blueberry muffin?", o:["Rubella/CMV","Measles","Varicella","Parvo","Syphilis"], a:0},
        {q:"Onion skin vessel?", o:["Malig HTN","Athero","DM","Vasc","Amyloid"], a:0},
        {q:"Red Man Syn?", o:["Vanco","PCN","Gent","Linez","Doxy"], a:0},
        {q:"Gray Baby?", o:["Chloramphenicol","Tetra","ASA","Sulfa","Fluoro"], a:0},
        {q:"Teeth discolor kid?", o:["Tetra","Amox","Azith","Cipro","Doxy"], a:0},
        {q:"Tendon rupture?", o:["Fluoroquinolone","Macro","PCN","Ceph","Amino"], a:0},
        {q:"Oto/Nephro toxic?", o:["Aminoglycosides","Macro","Tetra","PCN","Sulfa"], a:0},
        {q:"Antidote Acetaminophen?", o:["NAC","Naloxone","Flum","Atrop","Eth"], a:0},
        {q:"Antidote Opioid?", o:["Naloxone","NAC","Flum","Gluc","Ins"], a:0},
        {q:"Antidote Benzo?", o:["Flumazenil","Naloxone","Atrop","Pral","Dig"], a:0},
        {q:"Antidote Heparin?", o:["Protamine","Vit K","FFP","Idar","Andex"], a:0},
        {q:"Antidote Warfarin?", o:["Vit K","Prot","Flum","Gluc","Ins"], a:0},
        {q:"Malignant Hyperthermia rx?", o:["Dantrolene","Succ","Halo","Atrop","Lido"], a:0},
        {q:"C. diff rx?", o:["PO Vanco","IV Vanco","Cipro","Azith","Cef"], a:0},
        {q:"Syphilis rx?", o:["PCN G","Doxy","Azith","Cef","Cipro"], a:0},
        {q:"Gonorrhea rx?", o:["Ceftriaxone","PCN","Cipro","Doxy","Metro"], a:0},
        {q:"Chlamydia rx?", o:["Azith/Doxy","PCN","Cef","Metro","Vanco"], a:0},
        {q:"Trich rx?", o:["Metro","Fluc","PCN","Doxy","Azith"], a:0},
        {q:"Lyme rx?", o:["Doxy","Cipro","Metro","Vanco","Gent"], a:0},
        {q:"RMSF rx?", o:["Doxy","Chlor","PCN","Cef","Vanco"], a:0},
        {q:"Cough, sweat, hemoptysis. Dx?", o:["TB","Pneumo","Ca","Sarc","COPD"], a:0},
        {q:"Fever, stiff neck. Dx?", o:["Meningitis","Enceph","Abscess","Migraine","Stroke"], a:0},
        {q:"Meningitis adult cause?", o:["Strep pneumo","N men","List","H flu","Staph"], a:0},
        {q:"UTI cause?", o:["E coli","Kleb","Prot","Staph","Pseudo"], a:0},
        {q:"H pylori rx?", o:["PPI+Clar+Amox","PPI+Metro","Vanco","Cipro","Doxy"], a:0},
        {q:"Rice water stool?", o:["Cholera","Ecoli","Sal","Shig","Giar"], a:0},
        {q:"Bloody diarrhea burger?", o:["EHEC","Sal","Shig","Camp","Yer"], a:0},
        {q:"Diarrhea post-abx?", o:["C diff","Perf","Staph","Sal","Ecoli"], a:0},
        {q:"Hiking diarrhea?", o:["Giardia","Crypto","Ecoli","Sal","Shig"], a:0},
        {q:"Rust sputum?", o:["Strep pneumo","Staph","Kleb","Pseudo","Legion"], a:0},
        {q:"Currant jelly sputum?", o:["Klebsiella","Strep","Staph","Myco","Legion"], a:0},
        {q:"Walking pneumo?", o:["Mycoplasma","Strep","Staph","Hflu","Legion"], a:0},
        {q:"Pneumo+confus+diarrhea?", o:["Legionella","Myco","Strep","Staph","Kleb"], a:0},
        {q:"CF pneumonia?", o:["Pseudo","Strep","Staph","Hflu","Kleb"], a:0},
        {q:"Cat bite?", o:["Pasteurella","Bart","Staph","Strep","Eik"], a:0},
        {q:"Dog bite?", o:["Pasteurella","Capno","Staph","Strep","Eik"], a:0},
        {q:"Human bite?", o:["Eikenella","Past","Staph","Strep","Bart"], a:0},
        {q:"Cat scratch?", o:["Bartonella","Past","Toxo","Bruc","Yer"], a:0},
        {q:"Cat litter preg?", o:["Toxo","Bart","List","CMV","Rub"], a:0},
        {q:"Ring lesion HIV?", o:["Toxo","Lymph","Abscess","TB","Crypto"], a:0},
        {q:"Thrush+dysphagia HIV?", o:["Candida","CMV","HSV","GERD","Stric"], a:0},
        {q:"India ink?", o:["Cryptococcus","Candida","Asp","Mucor","Histo"], a:0},
        {q:"Broad bud yeast?", o:["Blasto","Histo","Cocci","Candida","Crypto"], a:0},
        {q:"Desert fungus?", o:["Coccidio","Histo","Blasto","Candida","Asp"], a:0},
        {q:"Bat/Cave fungus?", o:["Histo","Blasto","Cocci","Crypto","Asp"], a:0},
        {q:"Gardener nodules?", o:["Sporothrix","Staph","Strep","Candida","Asp"], a:0},
        {q:"Fungal ball?", o:["Aspergillus","Candida","Mucor","Histo","Blasto"], a:0},
        {q:"Black eschar face DM?", o:["Mucor","Asp","Candida","Staph","Strep"], a:0},
        {q:"Malaria vector?", o:["Anopheles","Aedes","Culex","Tick","Flea"], a:0},
        {q:"Dengue vector?", o:["Aedes","Anopheles","Culex","Tick","Flea"], a:0},
        {q:"Lyme vector?", o:["Ixodes","Dog","Mosq","Flea","Louse"], a:0},
        {q:"RMSF vector?", o:["Dermacentor","Ixodes","Mosq","Flea","Louse"], a:0}
    ];

    // --- MAIN LOGIC ---
    function startQuiz() {
        qList = [...db].sort(() => 0.5 - Math.random());
        currentIdx = 0;
        answers = {};
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        renderQuestion();
    }

    function renderQuestion() {
        const q = qList[currentIdx];
        document.getElementById('progress').innerText = `Q ${currentIdx + 1}/${qList.length}`;
        document.getElementById('q-text').innerText = q.q;

        const opts = document.getElementById('options');
        opts.innerHTML = '';

        q.o.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            
            const userAns = answers[currentIdx];
            if (userAns !== undefined) {
                if (i === q.a) btn.classList.add('correct');
                else if (i === userAns) btn.classList.add('wrong');
            } else {
                btn.onclick = () => { selectAnswer(i); };
            }
            opts.appendChild(btn);
        });

        // Update Score
        let correct = 0, total = 0;
        Object.keys(answers).forEach(idx => {
            total++;
            if (answers[idx] === qList[idx].a) correct++;
        });
        const pct = total === 0 ? 0 : Math.round((correct/total)*100);
        document.getElementById('score').innerText = `Score: ${pct}%`;

        document.getElementById('ai-box').style.display = 'none';
        document.getElementById('btn-prev').disabled = (currentIdx === 0);
        document.getElementById('btn-next').disabled = (currentIdx === qList.length - 1);
    }

    function selectAnswer(i) {
        answers[currentIdx] = i;
        renderQuestion();
    }

    function move(dir) {
        if (currentIdx + dir >= 0 && currentIdx + dir < qList.length) {
            currentIdx += dir;
            renderQuestion();
        }
    }

    function smartSearch() {
        const q = qList[currentIdx].q;
        const url = `https://www.perplexity.ai/search?q=${encodeURIComponent(q + " medical explanation")}`;
        window.open(url, '_blank');
    }

    async function askAI() {
        const box = document.getElementById('ai-box');
        box.style.display = 'block';
        box.innerHTML = "<div class='spinner'></div> <strong>AI is thinking...</strong>";
        
        const q = qList[currentIdx];
        const prompt = `Medical Tutor. Q: "${q.q}" Correct: "${q.o[q.a]}" Distractors: ${JSON.stringify(q.o)}. Explain why correct and why others wrong. Concise.`;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await response.json();
            
            if (data.error) {
                box.innerHTML = `<span style="color:red">‚ö†Ô∏è Error: ${data.error.message}</span>`;
            } else {
                let text = data.candidates[0].content.parts[0].text;
                text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                box.innerHTML = text;
            }
        } catch (err) {
            box.innerHTML = `<span style="color:red">‚ö†Ô∏è Connection Error. Check internet.</span>`;
        }
    }
</script>
</body>
</html>
